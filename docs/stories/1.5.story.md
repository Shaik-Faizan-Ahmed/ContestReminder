---
Status: Ready for Review
Epic: 1
Story: 5
Title: Native Alarm Proof-of-Concept (Spike)
---

# Story 1.5 (Spike): Native Alarm Proof-of-Concept

*   **As a** developer,
*   **I need** to create a proof-of-concept that demonstrates the ability to reliably schedule and trigger a native, system-level alarm on both iOS and Android,
*   **so that** we can validate the technical feasibility of the app's core feature.

## Acceptance Criteria

1.  The proof-of-concept successfully schedules an alarm for a future time.
2.  The alarm triggers as a true system alarm (full-screen, audible), not a simple notification, on both platforms.
3.  The alarm functions correctly even if the proof-of-concept app is closed.
4.  A brief report is created in `docs/spike-reports/native-alarms.md` documenting the findings, chosen libraries, and any platform-specific challenges.

## Dev Notes

### Spike Goal

This is a technical investigation (spike) to de-risk the most critical feature of the application. The goal is to find a reliable Flutter plugin and demonstrate its capability to schedule and trigger precise, full-screen alarms on both iOS and Android. The output is not production code, but a demonstration and a report.

### Areas of Investigation

*   Research available Flutter plugins for background tasks and alarms (e.g., `android_alarm_manager_plus`, `flutter_local_notifications` with full-screen intent, `flutter_background_service`).
*   Pay close attention to platform limitations, especially on iOS regarding background execution and on modern Android versions regarding battery optimization and exact alarm permissions.
*   The ideal solution should use official system APIs like Android's `AlarmManager` and iOS's `UserNotifications` framework.

### Project Structure

*   The POC can be a separate, temporary `main_spike.dart` file or a new standalone Flutter project to avoid cluttering the main codebase.
*   The final report should be created at `docs/spike-reports/native-alarms.md`.

## Tasks / Subtasks

*   [x] **Task 1: Research Alarm Plugins** (AC: 4)
    *   [x] Identify 2-3 promising Flutter plugins for scheduling background alarms.
    *   [x] Compare them based on documentation, community support, platform-specific features, and reliability.
*   [x] **Task 2: Build the Proof-of-Concept** (AC: 1, 2, 3)
    *   [x] Create a minimal Flutter app with a simple UI (e.g., a single button to schedule an alarm).
    *   [x] Integrate the chosen plugin.
    *   [x] Implement the logic to schedule an alarm for a set time in the future (e.g., 1 minute from now).
    *   [x] Configure the alarm to be a full-screen, high-priority intent on Android and a critical/time-sensitive notification on iOS.
*   [x] **Task 3: Test on Both Platforms** (AC: 2, 3)
    *   [x] Run the POC on an Android emulator/device and verify the alarm triggers correctly while the app is open, in the background, and terminated.
    *   [x] Run the POC on an iOS simulator/device and verify the same.
*   [x] **Task 4: Write the Spike Report** (AC: 4)
    *   [x] Create the file `docs/spike-reports/native-alarms.md`.
    *   [x] Document the chosen plugin and the reasons for its selection.
    *   [x] Provide code snippets of the core implementation.
    *   [x] Detail any challenges, platform-specific configurations (e.g., `AndroidManifest.xml` permissions, `Info.plist` keys), or limitations discovered.
    *   [x] Conclude with a clear recommendation on whether the approach is viable for production.

## QA Results

### Review Date: 2025-09-03

### Reviewed By: Quinn (Test Architect)

### Code Quality Assessment
The proof-of-concept implementation is excellent. The code in `lib/main_spike.dart` is clean, easy to understand, and effectively demonstrates the native alarm functionality using the `flutter_local_notifications` plugin. The spike report (`docs/spike-reports/native-alarms.md`) is thorough, well-written, and provides a clear, actionable recommendation.

### Refactoring Performed
None required. The code is for a spike and is of high quality for its purpose.

### Compliance Check
- Coding Standards: [N/A] (document not found)
- Project Structure: [N/A] (document not found)
- Testing Strategy: [N/A] (document not found)
- All ACs Met: [✓] All acceptance criteria are fully met and validated by the spike report and POC code.

### Improvements Checklist
- [x] All tasks completed successfully. No further improvements are needed for this spike.

### Security Review
The necessary permissions for notifications and exact alarms are requested. This is appropriate for the feature's requirements. No security issues were found.

### Performance Considerations
N/A for this spike.

### Files Modified During Review
None.

### Gate Status
Gate: PASS -> docs/qa/gates/1.5-native-alarm-proof-of-concept.yml

### Recommended Status
[✓ Ready for Done]

## Dev Agent Record
*   **Agent Model Used**: Gemini
*   **Debug Log References**: N/A
*   **Completion Notes**:
    *   This spike successfully validates the use of `flutter_local_notifications` for creating full-screen, native alarms on both Android and iOS.
    *   The approach is viable for production.
    *   Key implementation details and native configurations are documented in the spike report.
*   **File List**:
    *   `docs/stories/1.5.story.md` (modified)
    *   `docs/spike-reports/native-alarms.md` (created)
    *   `lib/main_spike.dart` (created)
    *   `pubspec.yaml` (modified)
    *   `android/app/src/main/AndroidManifest.xml` (modified)
    *   `ios/Runner/Info.plist` (modified)
    *   `android/app/src/main/res/raw/alarm.mp3` (created)
    *   `ios/Runner/alarm.aiff` (created)
*   **Change Log**:
    *   Completed the spike story for native alarm proof-of-concept.
