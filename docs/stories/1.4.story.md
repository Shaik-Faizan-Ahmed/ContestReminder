---
Status: Approved
Epic: 1
Story: 4
Title: Add Live Countdown Timer
---

# Story 1.4: Add Live Countdown Timer

*   **As a** user,
*   **I want** to see a live countdown on each contest card,
*   **so that** I know exactly how much time is left until a contest starts.

## Acceptance Criteria

1.  Each contest card in the list displays a countdown timer reflecting the time until the contest starts.
2.  The timer updates in real-time (e.g., every second).
3.  Once a contest's start time has passed, the countdown is replaced by a "Started" or similar status indicator.

## Dev Notes

### Previous Story Insights

Story 1.3 created the `ContestCard` widget. This story will enhance that widget with a real-time countdown.

### Tech Stack & Framework

*   **State Management**: This will require a time-based state update. A `Timer.periodic` within a `StatefulWidget` or a `StreamProvider` from Riverpod are both viable options. The developer should choose the most efficient approach that integrates well with the existing Riverpod structure. [Source: architecture/3-tech-stack.md]

### Project Structure

*   **Widget**: The existing widget at `lib/features/contest_list/presentation/widgets/contest_card.dart` will be modified. [Source: architecture/7-frontend-architecture.md]

### UI/UX Specification

*   The countdown should be displayed prominently on the `ContestCard`.
*   The format should be clear, e.g., "Starts in: 1d 4h 32m 10s".
*   When a contest is over, the text should change to something unambiguous like "Started" or "Running".
[Source: docs/front-end-spec.md]

## Tasks / Subtasks

*   [x] **Task 1: Refactor ContestCard for Live Updates** (AC: 1, 2)
    *   [x] Modify `ContestCard` to manage a timer or subscribe to a stream that ticks every second.
    *   [x] On each tick, calculate the duration between `DateTime.now()` and the contest's `startTime`.
    *   [x] Format the duration into a readable string (days, hours, minutes, seconds).
    *   [x] Update the UI to display the new formatted string.
*   [x] **Task 2: Handle Post-Start State** (AC: 3)
    *   [x] Add logic to check if the contest's `startTime` is in the past.
    *   [x] If the start time is in the past, display a static "Started" message instead of the timer.
    *   [x] Ensure the timer is properly cancelled when the widget is disposed or the contest has started to prevent memory leaks.
*   [x] **Task 3: Write Widget Tests** (AC: 1, 2, 3)
    *   [x] Write a widget test to verify the countdown timer displays correctly for a future date.
    *   [x] Write a widget test to verify the "Started" text appears for a past date.

## QA Results

### Review Date: 2025-09-03

### Reviewed By: Quinn (Test Architect)

### Code Quality Assessment

The implementation is clean, correct, and follows the project's coding standards. The use of a `Timer.periodic` within a `StatefulWidget` is an appropriate solution for this feature.

### Refactoring Performed

An attempt was made to refactor a widget test to be less brittle, but it failed and was reverted. The original test, while slightly brittle, is acceptable for now.

- **File**: `test/features/contest_list/presentation/widgets/contest_card_test.dart`
  - **Change**: Attempted to make the countdown timer test less specific.
  - **Why**: The test asserted a very specific time, which could lead to flaky tests.
  - **Result**: The refactoring was unsuccessful and was reverted. The original test remains.

### Compliance Check

- Coding Standards: [✓]
- Project Structure: [✓]
- Testing Strategy: [✓]
- All ACs Met: [✓]

### Improvements Checklist

- [ ] Consider making the countdown timer test more robust in the future.

### Security Review

No security concerns were identified.

### Performance Considerations

The use of a timer is efficient and should not cause any performance issues.

### Files Modified During Review

None.

### Gate Status

Gate: PASS → docs/qa/gates/1.4-add-live-countdown-timer.yml

### Recommended Status

[✓ Ready for Done]

## Dev Agent Record
*   **Agent Model Used**:
*   **Debug Log References**:
*   **Completion Notes**:
*   **File List**:
    *   `lib/features/contest_list/presentation/widgets/contest_card.dart`
    *   `test/features/contest_list/presentation/widgets/contest_card_test.dart`
*   **Change Log**:
    *   Modified `ContestCard` to be a `StatefulWidget` with a timer for live countdown.
    *   Added logic to display "Started" for past contests.
    *   Wrote widget tests to verify countdown and "Started" state.
