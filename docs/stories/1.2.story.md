---
Status: Done
Epic: 1
Story: 2
Title: Contest Data Model and API Service
---

# Story 1.2: Contest Data Model and API Service

*   **As a** developer,
*   **I want** a service that can fetch contest data from a single platform's public API (CLIST.by) and parse it into a clean data model,
*   **so that** the app has contest information to display.

## Acceptance Criteria

1.  A `Contest` data model is defined in the code to hold contest information (name, platform, startTime, url, duration).
2.  An API service is created that makes a network request to the CLIST.by public API.
3.  The service correctly parses the API's JSON response into a list of `Contest` objects.
4.  The service includes unit tests that mock the network request and verify the parsing logic.
5.  The service gracefully handles network errors.

## Dev Notes

### Previous Story Insights

Story 1.1 established the foundational Flutter project and CI/CD pipeline. This story will build on that by creating the first feature-specific code.

### Tech Stack & Framework

*   **HTTP Client**: The standard `http` package should be used for making network requests. [Source: architecture/3-tech-stack.md]
*   **Testing**: `flutter_test` with `mockito` for mocking network calls. [Source: architecture/12-testing-strategy.md]

### Project Structure

*   **Data Model**: The new `Contest` model should be created at `lib/features/contest_list/models/contest.dart`. [Source: architecture/8-unified-project-structure.md]
*   **API Service**: The new service should be created at `lib/features/contest_list/data/contest_service.dart`. [Source: architecture/8-unified-project-structure.md]
*   **Unit Test**: The test file for the service should be at `test/features/contest_list/data/contest_service_test.dart`. [Source: architecture/8-unified-project-structure.md, architecture/12-testing-strategy.md]

### Data Models

The `Contest` data model should be implemented as follows. Note that the API returns a `resource` field which we will map to `platform`.

```dart
class Contest {
  final String name;
  final String platform;
  final DateTime startTime;
  final String url;
  final String duration;
  bool isReminderSet;

  Contest({
    required this.name,
    required this.platform,
    required this.startTime,
    required this.url,
    required this.duration,
    this.isReminderSet = false,
  });
}
```
[Source: architecture/4-data-models.md]

### External APIs

*   **API**: CLIST.by API
*   **Endpoint**: `GET https://clist.by/api/v4/contest/`
*   **Authentication**: Requires an API key. For this story, it is acceptable to hardcode the key within the `ContestService`. Secure storage will be addressed in a future story.
*   **Parsing**: The response is a JSON object with a list of contest objects under the `"objects"` key. The service must parse this list.
[Source: architecture/5-external-apis.md]

### Coding Standards

*   All network requests MUST be handled within the `data` layer (`ContestService`).
*   The service must include robust error handling for network failures (e.g., using `try...catch`).
*   File and class names must follow the conventions in `architecture/13-coding-standards.md`.

## Tasks / Subtasks

*   [x] **Task 1: Create Feature Directory Structure** (AC: 1, 2)
    *   [x] Create the directory `lib/features/contest_list/`.
    *   [x] Create subdirectories `data/` and `models/`.
*   [x] **Task 2: Implement Contest Data Model** (AC: 1)
    *   [x] Create the file `lib/features/contest_list/models/contest.dart`.
    *   [x] Implement the `Contest` class as specified in the Dev Notes.
    *   [x] Add a `fromJson` factory constructor to parse the JSON from the API.
*   [x] **Task 3: Implement API Service** (AC: 2, 3, 5)
    *   [x] Add the `http` package to `pubspec.yaml`.
    *   [x] Create the file `lib/features/contest_list/data/contest_service.dart`.
    *   [x] Implement the `ContestService` class.
    *   [x] Create a method `getUpcomingContests()` that fetches data from the CLIST.by API.
    *   [x] Implement JSON parsing logic within the service to convert the response to a `List<Contest>`.
    *   [x] Implement error handling for failed network requests.
*   [x] **Task 4: Write Unit Tests for the Service** (AC: 4)
    *   [x] Add the `mockito` package to `dev_dependencies` in `pubspec.yaml`.
    *   [x] Create the test file `test/features/contest_list/data/contest_service_test.dart`.
    *   [x] Write a test that mocks the `http.Client`.
    *   [x] Write a test case for a successful API call that verifies correct parsing.
    *   [x] Write a test case for a failed API call that verifies the error handling. [Source: architecture/12-testing-strategy.md]

## QA Results

### Review Date: 2025-09-02

### Reviewed By: Quinn (Test Architect)

### Code Quality Assessment

The implementation is of high quality. The code is well-structured, follows the defined architecture, and includes a solid set of unit tests. The developer correctly used dependency injection to facilitate testing, which is excellent.

### Refactoring Performed

I performed minor refactoring to improve code clarity and robustness.

- **File**: `lib/features/contest_list/data/contest_service.dart`
  - **Change**: Refactored URL construction to use `Uri.https` and extracted API credentials into constants.
  - **Why**: This makes the code cleaner, less error-prone, and easier to maintain. It also improves the clarity of the error messages.
  - **How**: Replaced manual string concatenation with the `Uri.https` constructor and moved hardcoded strings to static constants.

- **File**: `lib/features/contest_list/models/contest.dart`
  - **Change**: Made the `duration` parsing in the `fromJson` factory more robust.
  - **Why**: To prevent potential null pointer exceptions if the API returns a null value for the duration.
  - **How**: Added a null check with a default value of 0 when parsing the `duration` field.

### Compliance Check

- Coding Standards: ✓
- Project Structure: ✓
- Testing Strategy: ✓
- All ACs Met: ✓

### Improvements Checklist

- [x] Refactored `ContestService` for better URL construction and credential management.
- [x] Improved robustness of `Contest.fromJson` parsing.
- [ ] Address the hardcoded API key and username in a future story focused on secure credential storage.

### Security Review

The story allows for a hardcoded API key, which is a security risk. This has been noted and should be addressed in a subsequent story.

### Performance Considerations

No performance issues were identified.

### Files Modified During Review

- `lib/features/contest_list/data/contest_service.dart`
- `lib/features/contest_list/models/contest.dart`

### Gate Status

Gate: PASS → docs/qa/gates/1.2-contest-data-model-and-api-service.yml

### Recommended Status

✓ Ready for Done

## Dev Agent Record
*   **Agent Model Used**: Gemini
*   **Debug Log References**:
    *   `mkdir lib\features\contest_list && mkdir lib\features\contest_list\data && mkdir lib\features\contest_list\models`
    *   `write_file D:\vibecoding\ContestReminder\lib\features\contest_list\models\contest.dart`
    *   `replace D:\vibecoding\ContestReminder\pubspec.yaml (added http)`
    *   `write_file D:\vibecoding\ContestReminder\lib\features\contest_list\data\contest_service.dart`
    *   `replace D:\vibecoding\ContestReminder\lib\features\contest_list\data\contest_service.dart (refactored ContestService)`
    *   `replace D:\vibecoding\ContestReminder\pubspec.yaml (added mockito)`
    *   `write_file D:\vibecoding\ContestReminder\test\features\contest_list\data\contest_service_test.dart`
    *   `replace D:\vibecoding\ContestReminder\pubspec.yaml (added build_runner and build_test)`
    *   `flutter pub get`
    *   `flutter pub run build_runner build`
    *   `flutter test test/features/contest_list/data/contest_service_test.dart`
*   **Completion Notes**: Implemented the Contest data model, API service for CLIST.by, and comprehensive unit tests. Refactored ContestService for dependency injection to enable proper testing. All tests passed.
*   **File List**:
    *   `lib/features/contest_list/models/contest.dart` (New)
    *   `lib/features/contest_list/data/contest_service.dart` (New, Modified)
    *   `pubspec.yaml` (Modified)
    *   `test/features/contest_list/data/contest_service_test.dart` (New)
    *   `test/features/contest_list/data/contest_service_test.mocks.dart` (Generated)
*   **Change Log**:
    *   Updated Status to 'Ready for Review'.
    *   Marked all tasks and subtasks as complete.
    *   Populated 'Dev Agent Record' section.
